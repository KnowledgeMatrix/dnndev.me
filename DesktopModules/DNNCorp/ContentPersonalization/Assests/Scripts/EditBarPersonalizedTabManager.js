
window.dnn=dnn||{};window.dnn.personalizedTabs=dnn.personalizedTabs||{};(function IIFE(){var EditBarPersonalizedTabManagerClass;EditBarPersonalizedTabManagerClass=(function IIFE(){'use strict';var HTML_PATH='Assests/Html/EditBarPersonalizedTabOptions.html';var HTML_BINDING_ID='editBarPersonalizedTabOptions';var PREFIX_MODULE_ACTIONS_ID="moduleActions";var ELEMENTS_ID_TO_BE_DELETED=["editBarSettingButton"];var DNN_MODULE_CLASS="DnnModule";var DNN_CONTENTLAYOUT_MODULE_CLASS="DnnModule-ContentLayout";var _viewModel;var _templateLoader;var _editBarContentPersonalizationCommonManager;var _editableModuleIds;var _nonEditableModuleIds;var resx;var dnnEditBarActiveCallback,iniListeners,initNonEditableModuleIds,addEditableModuleId,deleteNotAllowedElements,deleteEditBarButtons,deleteModuleActions,getModuleId,putMaskOverNonEditableModules,putMaskOverModule,createViewModel,disablePrivatePageIconButton,resxCallback200;EditBarPersonalizedTabManager.class='EditBarPersonalizedTabManager';EditBarPersonalizedTabManager.type='Class';_viewModel={};function EditBarPersonalizedTabManager(){_templateLoader=new window.dnn.personalizedTabs.TemplateLoader();_editableModuleIds=dnn.getVar('cem_EditBarPersonalizedTabResourcesSettings_editableModuleIds').split(',');initNonEditableModuleIds();iniListeners();}
initNonEditableModuleIds=function(){_nonEditableModuleIds=[];var $allModules=$(String.format(".{0}",DNN_MODULE_CLASS));$allModules.each(function(i,module){var moduleId=getModuleId($(module));if($.inArray(moduleId,_editableModuleIds)===-1){_nonEditableModuleIds.push(moduleId);}});}
iniListeners=function(){$(document).on("dnnEditBarActive",function(event,data){dnnEditBarActiveCallback();});};createViewModel=function(){_viewModel={personalizedPageName:dnn.getVar('dnn_content_personalization_personalized_page_name'),resx:{labels:{personalizedPage:resx.PersonalizedPage}}};};deleteEditBarButtons=function(){ELEMENTS_ID_TO_BE_DELETED.forEach(function(element){$('#'+element).remove();});};deleteModuleActions=function(){var editableModuleActionsIds=[];for(var i=0;i<_editableModuleIds.length;i++){editableModuleActionsIds.push(String.format("#{0}-{1}",PREFIX_MODULE_ACTIONS_ID,_editableModuleIds[i]));}
var nonEditableModuleActions=$(String.format("div[id^={0}]",PREFIX_MODULE_ACTIONS_ID)).not(editableModuleActionsIds.join(","));nonEditableModuleActions.find("ul.dnn_mact > li:not(.actionMenuMove, .actionMenuAdmin)");nonEditableModuleActions.find(".actionMenuAdmin li:not([id$='-Help'], [id$='-Delete'], :last-child) ").remove();};deleteNotAllowedElements=function(){deleteEditBarButtons();deleteModuleActions();};disablePrivatePageIconButton=function(){var $button=$('#edit-bar .private-page');$button.off('click');$button.css('cursor','auto');};putMaskOverModule=function($module){if($module.find(">div.dnnPersonalizedPageMaskContainer").length>0){return;}
var children=$module.children();var styles='background-color: #6F6F6F; opacity: .5; filter: Alpha(Opacity=50); z-index:990;';var $mask=$('<div class="dnnPersonalizedPageMask">').attr('style',styles+'position: absolute;left: 0; right: 0;top: 24px; bottom: 0;');var $div=$('<div class="dnnPersonalizedPageMaskContainer">').attr('style','position: relative');$div.append(children);$div.append($mask);$module.empty();$module.append($div);};putMaskOverNonEditableModules=function(){var editableModuleClasses=[];for(var i=0;i<_editableModuleIds.length;i++){editableModuleClasses.push(String.format(".{0}-{1}",DNN_MODULE_CLASS,_editableModuleIds[i]));}
var nonEditableModules=$(String.format(".{0}",DNN_MODULE_CLASS)).not(editableModuleClasses.join(",")).not(String.format(".{0}",DNN_CONTENTLAYOUT_MODULE_CLASS));$.each(nonEditableModules,function(key,nonEditableModule){putMaskOverModule($(nonEditableModule));});};getModuleId=function($module){return $module.attr("class").match(/DnnModule-([0-9]+)/)[1];}
addEditableModuleId=function(moduleId){if($.inArray(moduleId,_nonEditableModuleIds)===-1&&$.inArray(moduleId,_editableModuleIds)===-1){_editableModuleIds.push(moduleId);}}
var resxCallback200=function(data){resx=data.localization;createViewModel();deleteNotAllowedElements();disablePrivatePageIconButton();putMaskOverNonEditableModules();Sys.WebForms.PageRequestManager.getInstance().add_pageLoaded(function(sender,eventArgs){var $module=$(eventArgs._panelsUpdated[0]).find(String.format(".{0}",DNN_MODULE_CLASS));if($module.length===1){addEditableModuleId(getModuleId($module));}
setTimeout(function(){putMaskOverNonEditableModules();deleteNotAllowedElements();},100);});var toInject=[{extensionPointId:dnn.getVar('dnn_content_personalization_editBarOptionsExtensionPoint'),path:dnn.getVar('dnn_content_personalization_resourceroot')+HTML_PATH,viewModel:_viewModel,viewModelBindingId:HTML_BINDING_ID}];_editBarContentPersonalizationCommonManager=new window.dnn.personalizedTabs.EditBarContentPersonalizationCommonManager(toInject);};dnnEditBarActiveCallback=function(){var localizationOptions={service:'ContentPersonalization',controller:'Localization',resxName:'EditBarPersonalizedTabResourcesSettingsResx',resourceSettings:{local:{culture:dnn.getVar('cem_EditBarPersonalizedTabResourcesSettings_resx_culture'),resxTimeStamp:dnn.getVar('cem_EditBarPersonalizedTabResourcesSettings_resx_timestamp')}},resources:{method:'GetEditBarPersonalizedTabTable',paramName:null,callback200:resxCallback200,callbackError:null}};new dnn.utils.Localization(localizationOptions);};return EditBarPersonalizedTabManager;})();window.dnn.personalizedTabs.EditBarPersonalizedTabManager=EditBarPersonalizedTabManagerClass;}).call(this);$(window).load(function(){var editBarPersonalizedTabManager=new window.dnn.personalizedTabs.EditBarPersonalizedTabManager();});